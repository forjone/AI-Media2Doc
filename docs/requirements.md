# AI-Media2Doc 功能改造需求文档

## 项目背景

AI-Media2Doc 是一款基于 AI 大模型的 Web 工具（FastAPI + Vue 3），支持一键将视频和音频转化为多种风格的文档（知识笔记/小红书/公众号/思维导图/内容总结）。本次改造旨在增加 **AI 自动配图**、**多平台内容生成** 和 **多平台自动发布** 三大核心功能。

---

## 需求一：AI 自动配图

### 1.1 功能描述

在 LLM 生成文章内容后，自动从文章中提炼关键画面描述，调用 **Google Gemini nanobanana pro**（即 Gemini 3 Pro Image Preview）模型生成配图，并插入到文章对应位置。

### 1.2 详细流程

```
文章内容 → LLM 提取配图描述 → Gemini nanobanana pro 生成图片 → 插入文章
```

1. LLM 生成完整文章后，后端再次调用 LLM，从文章内容中提炼出 **3~6 个关键画面描述**（图片 prompt）
2. 将每个描述调用 Gemini nanobanana pro API 生成图片
3. 将生成的图片插入到文章中对应位置
4. 前端展示时渲染配图

### 1.3 技术方案

| 项目 | 方案 |
|------|------|
| 图片生成模型 | Google Gemini nanobanana pro（Gemini 3 Pro Image Preview） |
| Python SDK | `google-generativeai` |
| 配置项 | `GEMINI_API_KEY`、`GEMINI_IMAGE_MODEL`（默认值 `gemini-3-pro-image-preview`） |
| 图片存储 | 复用现有 S3/对象存储 |

### 1.4 与现有功能的关系

- 与现有 **智能截图**（从视频中截取关键帧）功能**并存**
- 用户可在设置中选择：**视频截图** / **AI 生成配图** / **两者都用**
- AI 配图适用于所有平台风格的内容生成

### 1.5 前端交互

- 设置面板新增"配图方式"选项：`智能截图` / `AI 配图` / `智能截图 + AI 配图`
- AI 配图生成过程中显示 loading 状态
- 支持用户对生成的配图进行**替换**或**重新生成**

---

## 需求二：多平台内容生成

### 2.1 功能描述

上传一个视频/音频文件后，用户可以**同时选择多个目标平台**，系统一次性为每个平台生成**适配该平台特性**的内容。

### 2.2 支持平台

| 平台 | 内容类型 | 说明 |
|------|---------|------|
| 小红书 | 图文笔记 | 短文案 + 配图，Emoji 风格，标签 |
| 微信公众号 | 长文章 | 结构化长文，图文排版 |
| 微信小绿书 | 图文短内容 | 多图 + 短文案，类似小红书风格 |
| 抖音 | 视频 + 描述 | 原始视频 + AI 生成的标题、描述、标签 |
| 视频号 | 视频 + 描述 | 原始视频 + AI 生成的标题、描述、标签 |
| 知识笔记 | Markdown 笔记 | 保留现有功能（仅生成不发布） |
| 思维导图 | 思维导图 JSON | 保留现有功能（仅生成不发布） |
| 内容总结 | 摘要 | 保留现有功能（仅生成不发布） |

### 2.3 前端交互

- 上传页面改造：从**单选**风格改为**多选**平台
- 选择多个平台后，点击"生成"，后端并行/串行为每个平台生成内容
- 结果页面改造：**Tab 切换**不同平台的内容预览
- 每个平台的内容支持**独立编辑**（富文本编辑器）
- 视频平台 Tab 显示视频预览 + 标题/描述/标签编辑框
- 文字平台 Tab 显示 Markdown 渲染 + 配图预览

### 2.4 技术要点

- 后端为每个平台维护独立的 **Prompt 模板**
- 视频平台的 Prompt 侧重生成：标题、描述文案、标签/话题
- 文字平台的 Prompt 沿用现有逻辑并优化
- 批量生成时支持进度展示（各平台独立进度）

---

## 需求三：多平台自动发布

### 3.1 功能描述

用户在编辑完各平台内容后，可以选择**一键发布**或**批量发布**到对应平台。

- 视频平台（抖音、视频号）→ 发布**原始视频** + AI 生成的标题/描述
- 文字平台（小红书、公众号、小绿书）→ 发布 **AI 生成的文章 + AI 配图**

### 3.2 各平台发布方案

| 平台 | 推荐方案 | 开源参考项目 | 备注 |
|------|---------|-------------|------|
| **小红书** | MCP Server | [xpzouying/xiaohongshu-mcp](https://github.com/xpzouying/xiaohongshu-mcp)、[aki66938/xhs-toolkit](https://github.com/aki66938/xhs-toolkit) | MCP 方案最成熟，支持图文发布 |
| **微信公众号** | MCP Server / 官方 API | [xwang152-jack/wechat-official-account-mcp](https://github.com/xwang152-jack/wechat-official-account-mcp)、[BobGod/wechat-publisher-mcp](https://github.com/BobGod/wechat-publisher-mcp) | 需要 AppID + AppSecret |
| **微信小绿书** | 浏览器自动化 | 暂无成熟方案 | 无官方 API，需通过模拟操作实现 |
| **抖音** | 浏览器自动化 | [dreammis/social-auto-upload](https://github.com/dreammis/social-auto-upload) | Playwright 模拟用户上传，支持定时发布 |
| **视频号** | 浏览器自动化 | [dreammis/social-auto-upload](https://github.com/dreammis/social-auto-upload) | Playwright 方案，同上 |

### 3.3 技术架构设计

```
┌─────────────────────────────────────────────────┐
│                   前端 (Vue 3)                    │
│  发布面板：选择平台 → 预览内容 → 确认发布 → 状态追踪  │
└───────────────────────┬─────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────┐
│              后端 (FastAPI)                       │
│  /api/v1/publish — 发布调度层                     │
│    ├── PublishManager（统一发布管理）               │
│    ├── 平台适配器（每个平台一个 Adapter）            │
│    └── 发布状态追踪 & 回调                         │
└───────────────────────┬─────────────────────────┘
                        │
          ┌─────────────┼──────────────┐
          ▼             ▼              ▼
   ┌────────────┐ ┌───────────┐ ┌──────────────┐
   │  MCP 方案   │ │ 官方API   │ │ 浏览器自动化  │
   │ 小红书/公众号│ │  公众号   │ │抖音/视频号/   │
   │            │ │          │ │小绿书        │
   └────────────┘ └───────────┘ └──────────────┘
```

### 3.4 发布流程

1. 用户在结果页面编辑各平台内容
2. 点击"发布"按钮，弹出确认对话框
3. 选择要发布的平台（可全选或部分选）
4. 后端异步执行发布任务
5. 前端轮询/WebSocket 展示各平台发布状态（排队中/发布中/成功/失败）
6. 支持失败重试

### 3.5 账号管理

- 新增"账号管理"设置页面
- 各平台需要的认证信息：
  - **小红书**：Cookie（通过扫码登录获取）
  - **公众号**：AppID + AppSecret 或 Cookie
  - **抖音**：Cookie（通过扫码登录获取）
  - **视频号**：Cookie（通过扫码登录获取）
  - **小绿书**：Cookie（通过微信扫码获取）
- 账号信息加密存储在本地

---

## 开发优先级建议

| 优先级 | 需求 | 原因 |
|--------|------|------|
| P0 | 多平台内容生成（需求二） | 基础能力，不依赖外部平台 API，改动可控 |
| P1 | AI 自动配图（需求一） | 依赖 Gemini API，需要配置 API Key |
| P2 | 多平台自动发布（需求三） | 复杂度最高，依赖外部平台，风控风险 |

---

## 风险提示

> [!WARNING]
> **平台风控风险**：通过浏览器自动化或非官方 API 发布内容，存在被平台检测并限制账号的风险（尤其是抖音、小红书）。建议：
> - 控制发布频率，模拟正常用户行为
> - 添加随机等待时间
> - 首次使用时提示用户相关风险

> [!IMPORTANT]
> **微信小绿书**：目前没有成熟的自动发布方案，可能需要通过浏览器自动化模拟微信客户端操作，难度较大。建议作为后期功能或降级为"生成内容 + 手动发布"。

> [!NOTE]
> **Gemini API 访问**：nanobanana pro (Gemini 3 Pro Image Preview) 需要确认你的 API Key 是否有该模型的访问权限，部分地区可能需要代理访问。
